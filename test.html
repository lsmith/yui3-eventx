<!doctype html>
<html>
<head>
    <title>Test Page</title>
</head>
<body class="yui3-skin-sam">
<p id="x">Treasure</p>

<script src="http://yui.yahooapis.com/3.8.1/build/yui/yui.js"></script>
<script src="event.js"></script>
<script>
YUI({
    filter: 'raw'
}).use('eventx', function (Y) {

function C(name) {
    this.name = name;
    Y.EventTarget.call(this);
}
Y.extend(C, Y.EventTarget);
Y.EventTarget.configure(C, {
    foo: { bubbles: false },
    bar: {
        defaultFn: function () {
            console.log("bar event behavior");
        },
        preventedFn: function () {
            console.log("bar behavior prevented");
        }
    },
    onetime: {
        fireOnce: true,
        defaultFn: function () {
            console.log("One Time event behavior - this should only be logged once");
        }
    }
});

var c = new C("Little C"),
    bigC = new C("Big C"),
    ultraC = new C("Ultra C"),
    lateralC = new C("Lateral C");

c.addTarget(bigC); // Should get event second
c.addTarget(lateralC); // Should get event third
bigC.addTarget(ultraC); // Should get event fourth
bigC.addTarget(lateralC); // Should NOT get event a second time
ultraC.addTarget(lateralC); // Should NOT get event a second time

/*
c.on("test", function (e) {
    console.log("Should be #1 - before: " + this.name, e.currentTarget);
});

c.after("test", function (e) {
    console.log("Should be last: " + e.get('data'), e.currentTarget);
});

bigC.on("test", function (e) {
    console.log("Should be #5, then #1 after c.detach() - from second bubble target in c's path (bigC)", e.currentTarget);
});

ultraC.on("test", function (e) {
    console.log("Should be #7, then #3 after c.detach() - from first bubble target in bigC's path (ultraC)", e.currentTarget);
});

c.on("test", function (e) {
    console.log("Should be #2 - before: " + this.name, e.currentTarget);
}, { name: "I'm NOT a C." });

c.subscribe("test", "before", function (e, nickname) {
    console.log("Should be #3 - before: " + this.name + ", but call me " + nickname, e.currentTarget);
}, null, "Tito");

*/
c.on({
    test: function (e) { console.log("Should be #4 - before", e.currentTarget); },
    foo: function (e) { console.log("Foo from c", e); },
    bar: function (e) { console.log("bar 1", e); }
});

/*
c.subscribe("test","middle", function (e) {
    console.log("Should NOT be logged.  'middle' is not a known phase.", e.currentTarget);
});

lateralC.on("test", function (e) {
    console.log("Should be #6, then #2 after c.detach() - from second bubble target in c's path (lateralC)", e.currentTarget);
});
*/

c.after("bar", function (e) {
    console.log("bar - after", e);
});

c.on("onetime", function (e) {
    console.log("Fire once event - before", e);
});
c.after("onetime", function (e) {
    console.log("Fire once event - after", e);
});

bigC.on('foo', function (e) {
    console.log("This should not be logged. foo doesn't bubble", e);
});

//c.fire("test", { data: "This is data from fire" });
c.fire("foo");
c.fire("bar");
c.fire("onetime");

c.detach();

c.on("bar", function (e) {
    e.preventDefault();
});
c.on("onetime", function (e) {
    console.log("Fire once event - subscribe 'before' after fired");
});
c.after("onetime", function (e) {
    console.log("Fire once event - subscribe 'after' after fired");
});

//c.fire("test", { data: "hopefully this does not show up" });
c.fire("bar");

console.log('And now for the Y tests');

Y.publish({
    bar: {
        defaultFn: function () {
            console.log("bar event behavior");
        },
        preventedFn: function () {
            console.log("bar behavior prevented");
        }
    },
    onetime: {
        fireOnce: true,
        defaultFn: function () {
            console.log("One Time event behavior - this should only be logged once");
        }
    }
});

Y.on("test", function (e) {
    console.log("Should be #1", e);
});

Y.after("test", function (e) {
    console.log("Should be last", e);
});

Y.on("test", function (e) {
    console.log("Should be #2", e);
});

Y.on("test", function (e) {
    console.log("Should be #3 - 'this' override: " + this.name, e);
}, { name: "I'm not Y." });

Y.subscribe("test", "before", function (e, nickname) {
    console.log("Should be #4 - arg: " + nickname, e);
}, null, "Tito");

Y.on({
    test: function (e) { console.log("Should be #5", e); },
    foo: function (e) { console.log("foo from Y", e); },
    bar: function (e) { console.log("bar 1", e); }
});

Y.subscribe("test", "middle", function (e) {
    console.log("Should NOT be logged.  'middle' is not a known phase.", e);
});

Y.after("bar", function (e) {
    console.log("bar - after", e);
});

Y.on("onetime", function (e) {
    console.log("Fire once event - before", e);
});

Y.after("onetime", function (e) {
    console.log("Fire once event - after", e);
});

Y.fire("test", { data: "This is data from fire" });
Y.fire("foo");
Y.fire("bar");
Y.fire("onetime");

Y.detach();

Y.on("bar", function (e) {
    e.preventDefault();
});
Y.on("onetime", function (e) {
    console.log("Fire once event - subscribe 'before' after fired");
});
Y.after("onetime", function (e) {
    console.log("Fire once event - subscribe 'after' after fired");
});

Y.fire("test", { data: "hopefully this does not show up" });
Y.fire("bar");

});
</script>
</body>
</html>
